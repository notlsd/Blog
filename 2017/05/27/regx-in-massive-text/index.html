<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="利用「正则表达式」可以显著的提高文档处理的效率。本文围绕下列例子，简要的介绍了如何通过正则表达式进行文档的快速查找与替换。
查找字符串 ^[►](\D*)(\d+).*替换字符串 -&amp;gt; b\2 [label=&amp;quot;\1&amp;quot;];">
    

    <!--Author-->
    
        <meta name="author" content="LIU Sida">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="利用「正则表达式」进行批量文本替换"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Not LSD"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>利用「正则表达式」进行批量文本替换 - Not LSD</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-93818123-1', 'auto');
        ga('send', 'pageview');

    </script>



</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/Resume2017.pdf">
                    Résumé
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/05/27/regx-in-massive-text/">
                利用「正则表达式」进行批量文本替换
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-05-27</span>
            
            
            
                <span class="category">
                    <a href="/categories/技术栈/">技术栈</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>利用「正则表达式」可以显著的提高文档处理的效率。本文围绕下列例子，简要的介绍了如何通过正则表达式进行文档的快速查找与替换。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">查找字符串 ^[►](\D*)(\d+).*</div><div class="line"></div><div class="line">替换字符串 -&gt; b\2 [label=&quot;\1&quot;];</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>请注意，「正则表达式」Regular Expression 简称 Regx，是一门博大而深邃的艺术，本文只能算作入门教程的导论<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top-right hint--error hint--large" aria-label="本文默认读者知悉基本的计算机文本编码规则。">[1]</span></a></sup> <sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top-right hint--error hint--large" aria-label="General Reference [正则表达式30分钟入门教程](http://deerchao.net/tutorials/regex/regex.htm) ">[2]</span></a></sup>。</p>
<h3 id="最简单的例子-删除多余空行"><a href="#最简单的例子-删除多余空行" class="headerlink" title="最简单的例子 - 删除多余空行"></a>最简单的例子 - 删除多余空行</h3><p>最直接的想法即是查找「换行符」直接删除，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">查找字符串 \n </div><div class="line">	</div><div class="line">替换字符串为空</div><div class="line"></div></pre></td></tr></table></figure>
<p>然而，这样是行不通的：</p>
<blockquote>
<p>第一行文本</p>
<p>第二行文本</p>
<p>第三行文本</p>
</blockquote>
<p>经过处理后就成为了：</p>
<blockquote>
<p>第一行文本第二行文本第三行文本</p>
</blockquote>
<p>正常段落间换行也被删除了。不过，稍加变化即可解决问题：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">查找字符串 ^\n</div><div class="line"></div></pre></td></tr></table></figure>
<p>在 Regx 中，<strong>^</strong> 标记行首；<strong>$</strong> 标记行尾。</p>
<p>上述代码的意思即是查找出现在行首的「换行符」，从而解决了上述问题。</p>
<h3 id="略微复杂的例子-删除行首行标"><a href="#略微复杂的例子-删除行首行标" class="headerlink" title="略微复杂的例子 - 删除行首行标"></a>略微复杂的例子 - 删除行首行标</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">查找字符串 ^\d+</div><div class="line"></div></pre></td></tr></table></figure>
<p>我们已经清楚通过 <strong>^</strong> 可以定位行首，现在新的问题是如何追踪到行标。凡事先问「是什么」，「行标」用自然语言来说，就是「出现在行首的一个或多个数字」。那么在 Regx 中可以用，\d+ 来表示。借此，引入「元字符」和「限定符」的概念，如下表：</p>
<table>
<thead>
<tr>
<th style="text-align:center">元字符</th>
<th style="text-align:left">匹配内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:left">匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td style="text-align:center">\ w</td>
<td style="text-align:left">匹配字母或数字或下划线或汉字</td>
</tr>
<tr>
<td style="text-align:center">\ b</td>
<td style="text-align:left">匹配单词的开始或结束</td>
</tr>
<tr>
<td style="text-align:center">\ s</td>
<td style="text-align:left">匹配任意的空白符</td>
</tr>
<tr>
<td style="text-align:center">\ d</td>
<td style="text-align:left">匹配数字</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:center">限定符</th>
<th style="text-align:left">重复次数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:left">重复零次或更多次</td>
</tr>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:left">重复一次或更多次</td>
</tr>
<tr>
<td style="text-align:center">?</td>
<td style="text-align:left">重复零次或一次</td>
</tr>
</tbody>
</table>
<h3 id="真实的应用：一堆文本与一个问题"><a href="#真实的应用：一堆文本与一个问题" class="headerlink" title="真实的应用：一堆文本与一个问题"></a>真实的应用：一堆文本与一个问题</h3><p>最近在处理一个超过十万字的 <sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top-right hint--error hint--large" aria-label="OCR - Optical Character Recognition「光学字符识别」，通俗的说，就是扫描件。此外，[ABBYY](www.abbyy.com/en-us/) 真乃 OCR 神器。">[3]</span></a></sup> 文本，需要把它处理为某种计算机可用的格式。里面含有大量的类似于这样的文本：</p>
<blockquote>
<p>► 指向 1984 。</p>
</blockquote>
<p>需要替换为这个</p>
<blockquote>
<p>-&gt; 1984 [label = “ 指向 “];</p>
</blockquote>
<p>其中，文本和数字都是任意的。这是个有些复杂的问题，最终解决的办法就是开头的那串复杂的 Regx，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">查找字符串 ^[►](\D*)(\d+).*</div><div class="line">	</div><div class="line">替换字符串 -&gt; b\2 [label=&quot;\1&quot;];</div><div class="line"></div></pre></td></tr></table></figure>
<p>除了上述章节已经提及的元素，首先映入眼帘的<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top-right hint--error hint--large" aria-label="这是「人民教育出版社九年制义务教育语文教科书」课文开头惯用语。">[4]</span></a></sup>，是一堆括号，那么就先来解释括号的意义。</p>
<ul>
<li><p>方括号 <strong>[ ]</strong> 指没有预定义的「元字符」集，比方说[►]就是指当匹配到任何一个「 ► 」的时候。同理， [aeiou]指匹配到任何一个元音字母的时候。</p>
</li>
<li><p>小括号 <strong>（ ）</strong> 指分组，每个组会被按照次序依次加上序号。替换字符串这里是最简单的应用，</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">\1 指代 (\D*) 的内容</div><div class="line"></div><div class="line">\2 指代 (\d+) 的内容</div><div class="line"></div></pre></td></tr></table></figure>
<p>显然，Regx 是大小写敏感的。再浏览一遍上面的 Regx，只有一个地方不清除了，<strong>\D</strong> 的意义。现在引入「反义字符」的概念</p>
<table>
<thead>
<tr>
<th style="text-align:center">反义字符</th>
<th style="text-align:left">匹配内容</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">\W</td>
<td style="text-align:left">匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td style="text-align:center">\B</td>
<td style="text-align:left">匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td style="text-align:center">\S</td>
<td style="text-align:left">匹配任意不是空白符的字符</td>
</tr>
<tr>
<td style="text-align:center">\D</td>
<td style="text-align:left">匹配任意非数字的字符</td>
</tr>
<tr>
<td style="text-align:center">^x</td>
<td style="text-align:left">匹配除了x以外的任意字符</td>
</tr>
</tbody>
</table>
<p>同理 [^aeiou] 匹配除了 a e i o u 这几个字母以外的任意字符。那么，用自然语言解释这一串 Regx 的意义即是：</p>
<p><strong>查找到行首；匹配 ► ；接着匹配任意数量非数字字符，编为第一组；接着匹配一个或多个数字，编为第二组；匹配任意数量的在本行的任意字符；完</strong></p>
<h3 id="一只-BUG-与「贪婪模式」"><a href="#一只-BUG-与「贪婪模式」" class="headerlink" title="一只 BUG 与「贪婪模式」"></a>一只 BUG 与「贪婪模式」</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">查找字符串 ^[►](*)(\d+).*</div><div class="line"></div></pre></td></tr></table></figure>
<p>之前处理此问题的时候，用的是上面这个 Regx ，但最后替换的结果令人哭笑不得</p>
<blockquote>
<p>-&gt; b4 [label=” 指向198”];</p>
</blockquote>
<p>原因如下：</p>
<blockquote>
<p>通常当 Regx 中包含能接受重复的限定符时，在使整个 Regx 能得到匹配的前提下，匹配尽可能多的字符。这被称为「贪婪模式」Greedy Mode 。与此对应的称之为「懒惰模式」Lazy Mode 。</p>
</blockquote>
<p>这样的话，在「► 指向 1984 。」中，前面的 * 一直取到 8 也就不足为奇了。</p>
<p>###</p>
<p>思考题：Unix Command </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"></div><div class="line">rm image*[02468].jpg evenImage </div><div class="line"></div></pre></td></tr></table></figure>
<p>是什么意思？<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top-right hint--error hint--large" aria-label="答案：将所有名称为偶数的 jpg 图像移动到同目录下的 evenImage 目录">[5]</span></a></sup></p>
<h3 id="综上所述"><a href="#综上所述" class="headerlink" title="综上所述"></a>综上所述</h3><p>Regx 也应该可以算作「计算机科学」中的上古神器之一 — 简洁，优雅，烧脑。</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">本文默认读者知悉基本的计算机文本编码规则。<a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">General Reference <a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="external">正则表达式30分钟入门教程</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">OCR - Optical Character Recognition「光学字符识别」，通俗的说，就是扫描件。此外，<a href="www.abbyy.com/en-us/">ABBYY</a> 真乃 OCR 神器。<a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">这是「人民教育出版社九年制义务教育语文教科书」课文开头惯用语。<a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">答案：将所有名称为偶数的 jpg 图像移动到同目录下的 evenImage 目录<a href="#fnref:5" rev="footnote"> ↩</a></span></li></ol></div></div>
    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 footer-about">
                <h2>About</h2>
                <p>
                    notlsd is an indie-game-developer under name of one=man game studio Gamearning. Knowledge can be expressed &nbsp &nbsp by games. 
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/01/15/reigns-state-machine/">「概率状态机」- 「王权」之下的铁王座</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/10/12/what-is-game/">What is Game - An Inspiration from GMS Archetechture</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/08/17/wearing-glasses/">「佩戴」还是「配戴」？这是个问题</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/08/03/alibaba-tencent-morgan-rockefeller/">阿里巴巴 &amp; 腾讯 -「新时代」的摩根 &amp; 洛克菲勒</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/07/03/asimov-foundation-series-end/">Trevize and Fallom - An Etymological Interpretation of the End of Asimov&#39;s Foundation Series</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/06/24/travel-frog-lifeline/">强制性等待与拖延的乐趣 - Lifeline 旅かえる 共同的设计原理</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/05/29/japan-1990s-china-2020s/">绕不开的房价：日本的 1990s 与中国的 2020s</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/07/14/the-fat-and-the-thin/">胖子与瘦子</a>
            </li>
            
        </ul>
    </div>


            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/iOS-101/">iOS 101</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/技术栈/">技术栈</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/搭基建/">搭基建</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/科学家/">科学家</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/万卷书/">万卷书</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/考据癖/">考据癖</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/产品论/">产品论</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/春秋笔/">春秋笔</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/拆游戏/">拆游戏</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/环滇骑迹/">环滇骑迹</a>
        </li>
        
    </ul>
</div>


        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/notlsd">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:iamliusida@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://notlsd.github.io/atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    © LIU Sida. All Rights Reserved | Powered by <a href="https://hexo.io/">Hexo</a> with <a href="https://github.com/klugjo/hexo-theme-alpha-dust">AlphaDust</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>